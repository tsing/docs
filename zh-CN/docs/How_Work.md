---
order: 3
---

# 工作原理

## NiceScale 整体架构

![NiceScale架构](/assets/nice_arch.png "NiceScale整体架构")

## Docker 服务

### 项目

NiceScale中将一个或多个服务、集群的组合称为项目。项目是一个管理单元，项目里的服务相互之间可见，并知道彼此如何交互。您可以创建一个项目，也可以从市场中部署一个集群或服务产生一个项目，并在以后仍然可以往项目中添加新的服务。

### 集群

相对单机而言，集群往往涉及到服务的扩展，多个服务的协调为一个整体对外服务。

### 服务

NiceScale中最基本的管理单元，如mysql、tomcat、php都是服务。这些服务都运行在Docker容器里面。

NiceScale同时提供了一个3个和Docker有关的特殊服务为用户提供类似私有dockerhub：
* DockerBuild
传入Dockerfile或giturl即可自动build并push到registry

一旦git仓库内容发生更新，将会自动Build

* DockerPull
列出官方的image，并可选择要下载的image，registry将会自动pull后放入registry

会自动更新下载的image服务

* DockerRegistry
私有的dockerhub

私有dockerhub支持单region，也支持多region。支持多region时，一个任务在其中某个region构建或pull，完成后分发到其他region。

## 云适配器
IaaS抽象层，主要抽象了网络、存储、虚拟机、IP等资源的API。

NiceScale中所有服务的部署都是在VPC中的，即用户可以在自己的私有网络中管理自己的服务。

有了云的适配器后，服务在多个云之间的移动才能成为可能。

## 管理策略
NiceScale中所有的管理都是基于策略(Policy)的，这些策略是以程序可理解的方式存储于策略中心，并由orchestration启动程序机器人抓取这些策略执行。

### 部署
通过控制台设置了部署有关策略后，orchestration单元将会依据deploy policy协调云API、服务发现系统部署好一个服务。

### 配置
配置发生变更后，服务发现系统将会通知有关服务从配置策略中心获取新的变化并应用。

### 监控
每个服务支持哪些监控，这些往往都是由该服务提供好。一旦开启该监控，则orchestration会定期执行该监控任务。

### 报警
往往和监控集成在一起。监控如何报警，报警给谁，以什么方式报警，这些都可以定义在Policy里。

### 扩展
服务节点的增加或减少。一旦节点发生变化，服务发现系统会通知相关系统进行自动更新

## 服务发现
### 服务注册和卸载

一个服务加入或删除，往往会影响到其他的服务，因此需要服务发现系统通知其他系统知道并妥善处理以避免故障。

### 名字服务

我们在定位服务时，往往需要为服务命名，方便程序书写，同时避免将IP、Port这样的信息写死在代码中。因此需要名字服务来为每个服务命名。NiceScale中的服务都有一个唯一的名称，并且会通过环境变量和配置文件的方式导出。这样在程序中可以方便地进行服务的connect连接。

## 协调引擎
它是NiceScale的调度中心，负责和策略中心、服务发现系统、云适配器沟通，并会启动程序机器人执行相关的管理任务。

